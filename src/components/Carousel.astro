---
import { Image } from 'astro:assets';

const { images } = Astro.props; 
---

<div class="carousel">
    <div class="carousel-inner">
        {images.map((image) => (
            <div class="slide">
                <Image src={image} alt="image" layout="constrained" loading="lazy" width="672px" height="672px" />
            </div>
        ))}
    </div>
    <div class="carousel-controls">
        <button id="prev"><img src="/icon-arrow.svg"/></button>
        <button id="next"><img src="/icon-arrow.svg"/></button>
    </div>
</div>

<script>

(function () {
    "use stict"
    const slideTimeout = 5000;
    const prev = document.querySelector('#prev');
    const next = document.querySelector('#next');
    const $slides = document.querySelectorAll('.slide');
    let intervalId;
    let currentSlide = 0;

    function slideTo(index) {
        currentSlide = index >= $slides.length || index < 1 ? 0 : index;
        $slides.forEach($elt => $elt.style.transform = `translateX(-${currentSlide * 100}%)`);
    }

    function showSlide() {
        slideTo(currentSlide);
        currentSlide++;
    }

    prev.addEventListener('click', () => slideTo(--currentSlide))
    next.addEventListener('click', () => slideTo(++currentSlide))

    // Initialisation de l'intervalle pour afficher les slides
    intervalId = setInterval(showSlide, slideTimeout)
    
    // Boucle sur tous les éléments de type "slide" pour ajouter des écouteurs d'événement pour les interactions avec la souris et le toucher
    $slides.forEach($elt => {
        let startX;
        let endX;

        $elt.addEventListener('mouseover', () => {
            clearInterval(intervalId);
        }, false)

        $elt.addEventListener('mouseout', () => {
            intervalId = setInterval(showSlide, slideTimeout);
        }, false);

        $elt.addEventListener('touchstart', (event) => {
            startX = event.touches[0].clientX;
        });

        $elt.addEventListener('touchend', (event) => {
            endX = event.changedTouches[0].clientX;
            if (startX > endX) {
                slideTo(currentSlide + 1);
            } else if (startX < endX) {
                slideTo(currentSlide - 1);
            }
        });

    })
})()

// (function () {
//     "use stict"
//     const prev = document.querySelector('#prev');
//     const next = document.querySelector('#next');
//     const $slides = document.querySelectorAll('.slide');
//     let currentSlide = 0;

//     function slideTo(index) {
//         currentSlide = index >= $slides.length || index < 1 ? 0 : index;
//         $slides.forEach($elt => $elt.style.transform = `translateX(-${currentSlide * 100}%)`);
//     }

//     prev.addEventListener('click', () => slideTo(--currentSlide))
//     next.addEventListener('click', () => slideTo(++currentSlide))

//     $slides.forEach($elt => {
//         let startX;
//         let endX;
//         $elt.addEventListener('touchstart', (event) => {
//             startX = event.touches[0].clientX;
//         });
//         $elt.addEventListener('touchend', (event) => {
//             endX = event.changedTouches[0].clientX;
//             if (startX > endX) {
//                 slideTo(currentSlide + 1);
//             } else if (startX < endX) {
//                 slideTo(currentSlide - 1);
//             }
//         });
//     })
// })()
</script>

<style>
.carousel {
    position: relative;
}
.carousel-inner {
    display: flex;
    overflow: hidden;
    flex-wrap: nowrap;
    aspect-ratio: 1;
}
.slide {
    flex: 0 0 100%;
    height: 100%;
    transition: .5s ease-in-out;
}
.slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.carousel-controls {
    position: absolute;
    z-index: 5;
    left: 0;
    right: 0;
    top: 50%;
    display: flex;
    justify-content: space-between;
}
.carousel-controls button {
    padding: 12px;
    background-color: #000;
    border: none;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
}
.carousel-controls button img {
    width: 22px;
    filter: invert(1);
    height: 20px;
}
.carousel-controls button#next img {
    transform: rotate(180deg);
}
</style>